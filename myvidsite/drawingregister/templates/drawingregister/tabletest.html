<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js" crossorigin="anonymous"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
	<style>
		/*td {
			background-color: none !important;
			background: none !important;
		}*/
		/*tr:nth-child(even) {background: rgba(0,0,0,0.1);}*/
    .ghosted{
      display: none;
    }
	</style>
</head>
<body>
<div style="width:100%" id="example"></div>
</body>

<h1>Hello World</h1>
<script type="text/javascript">
console.log("hello world")

var data = {{data|safe}};
// var rowHeaders = ['2017', '2018', '2019']
var colHeaders= [
// 'id',
'dn_project','dn_originator','dn_volume_system','dn_type','dn_discipline','dn_series','dn_level','dn_zone_sequence',]

var columns = [
  // {className:"abc",      renderer: myRenderer, data:'id'},
  {className:"abc",      renderer: myRenderer, data:'dn_project'},
  {className:"enabled",  renderer: myRenderer, data:'dn_originator'},
  {className:"abc",      renderer: myRenderer, data:'dn_volume_system'},
  {className:"abc",      renderer: myRenderer, data:'dn_type'},
  {className:"abc",      renderer: myRenderer, data:'dn_discipline'},
  {className:"abc",      renderer: myRenderer, data:'dn_series'},
  {className:"abc",      renderer: myRenderer, data:'dn_level'},
  {className:"abc",      renderer: myRenderer, data:'dn_zone_sequence'},
    // type: 'dropdown', source: ['yellow', 'red', 'orange', 'green', 'blue', 'gray', 'black', 'white', 5]
  ]



var container = document.getElementById('example');




var hot = new Handsontable(container, {
  licenseKey: 'non-commercial-and-evaluation',
  data: data,
  dataSchema: {id: null, name:{last: null, first: null}, address: null},
  // rowHeaders: true,
  colHeaders: colHeaders,
  // width: '100%',
  // stretchH: 'all',
  columns: columns,
  // colWidths: [45, 100, 160, 160, 80, 80, 80],
  manualColumnResize: true,
  manualColumnMove: true,
  // fixedColumnsLeft: 1,
  // contextMenu: ['row_above', 'row_below', 'remove_row'],
  contextMenu: true,
  manualColumnFreeze: true,
  observeChanges: true,

  // dropdownMenu: true,
  // colHeaders: true,
  // filters: true,
  // dropdownMenu: true,
  // afterChange: (changes) => {
  //   changes.forEach(([y, x, oldValue, newValue]) => {
  //     console.log(x,y,oldValue,newValue);
  //     console.log(rowHeaders[y], colHeaders[x]);
  //   });
  // }
  afterChange: function (change, source) {
    // if (source === 'loadData') {
      // return; //don't save this change
    // }
    // if (!autosave.checked) {
      // return;
    // }
    // clearTimeout(autosaveNotification);
    if (source != 'loadData'){

    var payload = {data:[]}
    console.log(change);
    // console.log(source);
    // console.log(this);
    for ( var i = 0; i < change.length; i ++ ) {
      // console.log(change[i]);
      editheaders = this.getColHeader();
      // console.log(editheaders);
      col = editheaders.indexOf(change[i][1])
      var value = this.getCell(change[i][0],col).id;
      console.log(value, change[i][1], change[i][3]);
      apob = {id: value}
      apob[change[i][1]] = change[i][3]
      payload["data"].push(apob);
      }
    console.log(payload);
    }
    // console.log(source);
    // ajax('scripts/json/save.json', 'GET', JSON.stringify({data: change}), function (data) {
    //   exampleConsole.innerText  = 'Autosaved (' + change.length + ' ' + 'cell' + (change.length > 1 ? 's' : '') + ')';
    //   autosaveNotification = setTimeout(function() {
    //     exampleConsole.innerText ='Changes will be autosaved';
    //   }, 1000);
    // });
  }

});
function myRenderer(instance, td, row, col, prop, value, cellProperties) {
  // Handsontable.TextCell.renderer.apply(this, arguments);
  // Handsontable.renderers.BaseRenderer.apply(this, arguments);
//             ^^^^^^^^  you can change TextCell for any other supported renderer
  // console.log("------------------------------------------------------------");
  // console.log(instance);
  // console.log(td);
  // console.log(row);
  // console.log(col);
  // console.log(prop);
  // console.log(value);
  // console.log(cellProperties);
  td.innerHTML = value;
  td.id = data[row]["id"];
  return td
}


</script>
</html>